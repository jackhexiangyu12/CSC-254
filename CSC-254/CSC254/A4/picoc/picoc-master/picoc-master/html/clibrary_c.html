<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head>
<body><pre><a name="1"><font color="gray">/*<searched> picoc mini standard C library - provides an optional tiny C standard library </a>
<a name="2"> * if BUILTIN_MINI_STDLIB is defined */</font> </a>
<a name="3"> </a>
<a name="4">#include "picoc.h"</a>
<a name="5">#include "interpreter.h"</a>
<a name="6"></a>
<a name="7"></a>
<a name="8"><font color="gray">/*<searched> endian-ness checking */</font></a>
<a name="9">static const <font color="red">int</font> <a name="searched">__ENDIAN_CHECK__</a> = 1;</a>
<a name="10">static <font color="red">int</font> <a name="searched">BigEndian</a>;</a>
<a name="11">static <font color="red">int</font> <a name="searched">LittleEndian</a>;</a>
<a name="12"></a>
<a name="13"></a>
<a name="14"><font color="gray">/*<searched> global initialisation for libraries */</font></a>
<a name="15"><font color="red">void</font> <a name="searched">LibraryInit</a>(Picoc *<a name="searched">pc</a>)</a>
<a name="16">{</a>
<a name="17">    </a>
<a name="18">    <font color="gray">/*<searched> define the version number macro */</font></a>
<a name="19">    <a href="clibrary_c.html#15">pc</a>-&gtVersionString = <a href="table_c.html#166">TableStrRegister</a>(pc, PICOC_VERSION);</a>
<a name="20">    <a href="variable_c.html#375">VariableDefinePlatformVar</a>(pc, NULL, "PICOC_VERSION", <a href="clibrary_c.html#15">pc</a>-&gtCharPtrType, (union AnyValue *)&<a href="clibrary_c.html#15">pc</a>-&gtVersionString, FALSE);</a>
<a name="21"></a>
<a name="22">    <font color="gray">/*<searched> define endian-ness macros */</font></a>
<a name="23">    <a href="clibrary_c.html#10">BigEndian</a> = ((*(<font color="red">char</font>*)&<a href="clibrary_c.html#9">__ENDIAN_CHECK__</a>) == 0);</a>
<a name="24">    <a href="clibrary_c.html#11">LittleEndian</a> = ((*(<font color="red">char</font>*)&<a href="clibrary_c.html#9">__ENDIAN_CHECK__</a>) == 1);</a>
<a name="25"></a>
<a name="26">    <a href="variable_c.html#375">VariableDefinePlatformVar</a>(pc, NULL, "BIG_ENDIAN", &<a href="clibrary_c.html#15">pc</a>-&gtIntType, (union AnyValue *)&<a href="clibrary_c.html#10">BigEndian</a>, FALSE);</a>
<a name="27">    <a href="variable_c.html#375">VariableDefinePlatformVar</a>(pc, NULL, "LITTLE_ENDIAN", &<a href="clibrary_c.html#15">pc</a>-&gtIntType, (union AnyValue *)&<a href="clibrary_c.html#11">LittleEndian</a>, FALSE);</a>
<a name="28">}</a>
<a name="29"></a>
<a name="30"><font color="gray">/*<searched> add a library */</font></a>
<a name="31"><font color="red">void</font> <a name="searched">LibraryAdd</a>(Picoc *<a name="searched">pc</a>, <font color="brown">struct</font> Table *<a name="searched">GlobalTable</a>, const <font color="red">char</font> *<a name="searched">LibraryName</a>, <font color="brown">struct</font> LibraryFunction *<a name="searched">FuncList</a>)</a>
<a name="32">{</a>
<a name="33">    <font color="brown">struct</font> ParseState <a name="searched">Parser</a>;</a>
<a name="34">    <font color="red">int</font> <a name="searched">Count</a>;</a>
<a name="35">    <font color="red">char</font> *<a name="searched">Identifier</a>;</a>
<a name="36">    <font color="brown">struct</font> ValueType *<a name="searched">ReturnType</a>;</a>
<a name="37">    <font color="brown">struct</font> Value *<a name="searched">NewValue</a>;</a>
<a name="38">    <font color="red">void</font> *<a name="searched">Tokens</a>;</a>
<a name="39">    <font color="red">char</font> *<a name="searched">IntrinsicName</a> = <a href="table_c.html#166">TableStrRegister</a>(pc, "c library");</a>
<a name="40">    </a>
<a name="41">    <font color="gray">/*<searched> read all the library definitions */</font></a>
<a name="42">    <font color="green">for</font> (Count = 0; <a href="clibrary_c.html#31">FuncList</a>[<a href="clibrary_c.html#34">Count</a>].Prototype != NULL; <a href="clibrary_c.html#34">Count</a>++)</a>
<a name="43">    {</a>
<a name="44">        <a href="clibrary_c.html#38">Tokens</a> = <a href="lex_c.html#593">LexAnalyse</a>(pc, <a href="clibrary_c.html#39">IntrinsicName</a>, <a href="clibrary_c.html#31">FuncList</a>[<a href="clibrary_c.html#34">Count</a>].Prototype, strlen((<font color="red">char</font> *)FuncList[<a href="clibrary_c.html#34">Count</a>].Prototype), NULL);</a>
<a name="45">        <a href="lex_c.html#610">LexInitParser</a>(&<a href="clibrary_c.html#33">Parser</a>, <a href="clibrary_c.html#31">pc</a>, <a href="clibrary_c.html#31">FuncList</a>[<a href="clibrary_c.html#34">Count</a>].Prototype, <a href="clibrary_c.html#38">Tokens</a>, <a href="clibrary_c.html#39">IntrinsicName</a>, TRUE, FALSE);</a>
<a name="46">        <a href="type_c.html#526">TypeParse</a>(&<a href="clibrary_c.html#33">Parser</a>, &<a href="clibrary_c.html#36">ReturnType</a>, &<a href="clibrary_c.html#35">Identifier</a>, NULL);</a>
<a name="47">        <a href="clibrary_c.html#37">NewValue</a> = <a href="parse_c.html#59">ParseFunctionDefinition</a>(&<a href="clibrary_c.html#33">Parser</a>, <a href="clibrary_c.html#36">ReturnType</a>, <a href="clibrary_c.html#35">Identifier</a>);</a>
<a name="48">        <a href="clibrary_c.html#37">NewValue</a>-&gtVal-&gtFuncDef.Intrinsic = <a href="clibrary_c.html#31">FuncList</a>[<a href="clibrary_c.html#34">Count</a>].Func;</a>
<a name="49">        <a href="heap_c.html#226">HeapFreeMem</a>(pc, <a href="clibrary_c.html#38">Tokens</a>);</a>
<a name="50">    }</a>
<a name="51">}</a>
<a name="52"></a>
<a name="53"><font color="gray">/*<searched> print a type to a stream without using printf/sprintf */</font></a>
<a name="54"><font color="red">void</font> Print<a name="searched">Typ</a>e(<font color="brown">struct</font> Value<a name="searched">Typ</a>e *<a name="searched">Typ</a>, IOFILE *<a name="searched">Stream</a>)</a>
<a name="55">{</a>
<a name="56">    <font color="green">switch</font> (Typ-&gtBase)</a>
<a name="57">    {</a>
<a name="58">        <font color="green">case</font> TypeVoid:          <a href="stdio_c.html#729">PrintStr</a>("<font color="red">void</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="59">        <font color="green">case</font> TypeInt:           <a href="stdio_c.html#729">PrintStr</a>("<font color="red">int</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="60">        <font color="green">case</font> TypeShort:         <a href="stdio_c.html#729">PrintStr</a>("<font color="red">short</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="61">        <font color="green">case</font> TypeChar:          <a href="stdio_c.html#729">PrintStr</a>("<font color="red">char</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="62">        <font color="green">case</font> TypeLong:          <a href="stdio_c.html#729">PrintStr</a>("<font color="red">long</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="63">        <font color="green">case</font> TypeUnsignedInt:   <a href="stdio_c.html#729">PrintStr</a>("<font color="red">unsigned</font> <font color="red">int</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="64">        <font color="green">case</font> TypeUnsignedShort: <a href="stdio_c.html#729">PrintStr</a>("<font color="red">unsigned</font> <font color="red">short</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="65">        <font color="green">case</font> TypeUnsignedLong:  <a href="stdio_c.html#729">PrintStr</a>("<font color="red">unsigned</font> <font color="red">long</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="66">        <font color="green">case</font> TypeUnsignedChar:  <a href="stdio_c.html#729">PrintStr</a>("<font color="red">unsigned</font> <font color="red">char</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="67">#ifndef NO_FP</a>
<a name="68">        <font color="green">case</font> TypeFP:            <a href="stdio_c.html#729">PrintStr</a>("<font color="red">double</font>", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="69">#endif</a>
<a name="70">        <font color="green">case</font> TypeFunction:      <a href="stdio_c.html#729">PrintStr</a>("function", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="71">        <font color="green">case</font> TypeMacro:         <a href="stdio_c.html#729">PrintStr</a>("macro", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="72">        <font color="green">case</font> TypePointer:       <font color="green">if</font> (Typ-&gtFromType) <a href="clibrary_c.html#54">PrintType</a>(Typ-&gtFromType, <a href="clibrary_c.html#54">Stream</a>); <a href="stdio_c.html#719">PrintCh</a>('*', <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="73">        <font color="green">case</font> TypeArray:         <a href="clibrary_c.html#54">PrintType</a>(Typ-&gtFromType, <a href="clibrary_c.html#54">Stream</a>); <a href="stdio_c.html#719">PrintCh</a>('[', <a href="clibrary_c.html#54">Stream</a>); <font color="green">if</font> (Typ-&gtArraySize != 0) <a href="stdio_c.html#724">PrintSimpleInt</a>(Typ-&gtArraySize, <a href="clibrary_c.html#54">Stream</a>); <a href="stdio_c.html#719">PrintCh</a>(']', <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="74">        <font color="green">case</font> TypeStruct:        <a href="stdio_c.html#729">PrintStr</a>("<font color="brown">struct</font> ", <a href="clibrary_c.html#54">Stream</a>); <a href="stdio_c.html#729">PrintStr</a>( <a href="clibrary_c.html#54">Typ</a>-&gtIdentifier, <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="75">        <font color="green">case</font> TypeUnion:         <a href="stdio_c.html#729">PrintStr</a>("union ", <a href="clibrary_c.html#54">Stream</a>); <a href="stdio_c.html#729">PrintStr</a>(Typ-&gtIdentifier, <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="76">        <font color="green">case</font> TypeEnum:          <a href="stdio_c.html#729">PrintStr</a>("<font color="red">enum</font> ", <a href="clibrary_c.html#54">Stream</a>); <a href="stdio_c.html#729">PrintStr</a>(Typ-&gtIdentifier, <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="77">        <font color="green">case</font> TypeGotoLabel:     <a href="stdio_c.html#729">PrintStr</a>("<font color="green">goto</font> label ", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="78">        <font color="green">case</font> Type_Type:         <a href="stdio_c.html#729">PrintStr</a>("type ", <a href="clibrary_c.html#54">Stream</a>); break;</a>
<a name="79">    }</a>
<a name="80">}</a>
<a name="81"></a>
<a name="82"></a>
<a name="83">#ifdef BUILTIN_MINI_STDLIB</a>
<a name="84"></a>
<a name="85"><font color="gray">/*<searched> </a>
<a name="86"> * This is a simplified standard library for small embedded systems. It doesn't require</a>
<a name="87"> * a system stdio library to operate.</a>
<a name="88"> *</a>
<a name="89"> * A more complete standard library for larger computers is in the library_XXX.c files.</a>
<a name="90"> */</font></a>
<a name="91"> </a>
<a name="92">static <font color="red">int</font> TRUEValue = 1;</a>
<a name="93">static <font color="red">int</font> <a href="unistd_c.html#10">ZeroValue</a> = 0;</a>
<a name="94"></a>
<a name="95"><font color="red">void</font> <a href="stdio_c.html#46">BasicIOInit</a>(Picoc *pc)</a>
<a name="96">{</a>
<a name="97">    pc-&gtCStdOutBase.Putch = &<a href="platform_unix_c.html#76">PlatformPutc</a>;</a>
<a name="98">    pc-&gtCStdOut = &CStdOutBase;</a>
<a name="99">}</a>
<a name="100"></a>
<a name="101"><font color="gray">/*<searched> initialise the C library */</font></a>
<a name="102"><font color="red">void</font> CLibraryInit(Picoc *pc)</a>
<a name="103">{</a>
<a name="104">    <font color="gray">/*<searched> define some constants */</font></a>
<a name="105">    <a href="variable_c.html#375">VariableDefinePlatformVar</a>(pc, NULL, "NULL", &IntType, (union AnyValue *)&<a href="unistd_c.html#10">ZeroValue</a>, FALSE);</a>
<a name="106">    <a href="variable_c.html#375">VariableDefinePlatformVar</a>(pc, NULL, "TRUE", &IntType, (union AnyValue *)&TRUEValue, FALSE);</a>
<a name="107">    <a href="variable_c.html#375">VariableDefinePlatformVar</a>(pc, NULL, "FALSE", &IntType, (union AnyValue *)&<a href="unistd_c.html#10">ZeroValue</a>, FALSE);</a>
<a name="108">}</a>
<a name="109"></a>
<a name="110"><font color="gray">/*<searched> stream for writing into strings */</font></a>
<a name="111"><font color="red">void</font> SPutc(<font color="red">unsigned</font> <font color="red">char</font> Ch, union OutputStreamInfo *Stream)</a>
<a name="112">{</a>
<a name="113">    <font color="brown">struct</font> StringOutputStream *Out = &Stream-&gtStr;</a>
<a name="114">    *Out-&gtWritePos++ = Ch;</a>
<a name="115">}</a>
<a name="116"></a>
<a name="117"><font color="gray">/*<searched> print a character to a stream without using printf/sprintf */</font></a>
<a name="118"><font color="red">void</font> <a href="stdio_c.html#719">PrintCh</a>(<font color="red">char</font> OutCh, <font color="brown">struct</font> OutputStream *Stream)</a>
<a name="119">{</a>
<a name="120">    (*Stream-&gtPutch)(OutCh, &Stream-&gti);</a>
<a name="121">}</a>
<a name="122"></a>
<a name="123"><font color="gray">/*<searched> print a string to a stream without using printf/sprintf */</font></a>
<a name="124"><font color="red">void</font> <a href="stdio_c.html#729">PrintStr</a>(const <font color="red">char</font> *Str, <font color="brown">struct</font> OutputStream *Stream)</a>
<a name="125">{</a>
<a name="126">    <font color="green">while</font> (*Str != 0)</a>
<a name="127">        <a href="stdio_c.html#719">PrintCh</a>(*Str++, Stream);</a>
<a name="128">}</a>
<a name="129"></a>
<a name="130"><font color="gray">/*<searched> print a single character a given number of times */</font></a>
<a name="131"><font color="red">void</font> PrintRepeatedChar(Picoc *pc, <font color="red">char</font> ShowChar, <font color="red">int</font> Length, <font color="brown">struct</font> OutputStream *Stream)</a>
<a name="132">{</a>
<a name="133">    <font color="green">while</font> (Length-- &gt 0)</a>
<a name="134">        <a href="stdio_c.html#719">PrintCh</a>(ShowChar, Stream);</a>
<a name="135">}</a>
<a name="136"></a>
<a name="137"><font color="gray">/*<searched> print an unsigned integer to a stream without using printf/sprintf */</font></a>
<a name="138"><font color="red">void</font> PrintUnsigned(<font color="red">unsigned</font> <font color="red">long</font> Num, <font color="red">unsigned</font> <font color="red">int</font> Base, <font color="red">int</font> FieldWidth, <font color="red">int</font> ZeroPad, <font color="red">int</font> LeftJustify, <font color="brown">struct</font> OutputStream *Stream)</a>
<a name="139">{</a>
<a name="140">    <font color="red">char</font> Result[33];</a>
<a name="141">    <font color="red">int</font> ResPos = sizeof(Result);</a>
<a name="142"></a>
<a name="143">    Result[--ResPos] = '\0';</a>
<a name="144">    <font color="green">if</font> (Num == 0)</a>
<a name="145">        Result[--ResPos] = '0';</a>
<a name="146">            </a>
<a name="147">    <font color="green">while</font> (Num &gt 0)</a>
<a name="148">    {</a>
<a name="149">        <font color="red">unsigned</font> <font color="red">long</font> NextNum = Num / Base;</a>
<a name="150">        <font color="red">unsigned</font> <font color="red">long</font> Digit = Num - NextNum * Base;</a>
<a name="151">        <font color="green">if</font> (Digit &lt 10)</a>
<a name="152">            Result[--ResPos] = '0' + Digit;</a>
<a name="153">        <font color="green">else</font></a>
<a name="154">            Result[--ResPos] = 'a' + Digit - 10;</a>
<a name="155">        </a>
<a name="156">        Num = NextNum;</a>
<a name="157">    }</a>
<a name="158">    </a>
<a name="159">    <font color="green">if</font> (FieldWidth &gt 0 && !LeftJustify)</a>
<a name="160">        PrintRepeatedChar(ZeroPad ? '0' : ' ', FieldWidth - (sizeof(Result) - 1 - ResPos), Stream);</a>
<a name="161">        </a>
<a name="162">    <a href="stdio_c.html#729">PrintStr</a>(&Result[ResPos], Stream);</a>
<a name="163"></a>
<a name="164">    <font color="green">if</font> (FieldWidth &gt 0 && LeftJustify)</a>
<a name="165">        PrintRepeatedChar(' ', FieldWidth - (sizeof(Result) - 1 - ResPos), Stream);</a>
<a name="166">}</a>
<a name="167"></a>
<a name="168"><font color="gray">/*<searched> print an integer to a stream without using printf/sprintf */</font></a>
<a name="169"><font color="red">void</font> <a href="stdio_c.html#724">PrintSimpleInt</a>(<font color="red">long</font> Num, <font color="brown">struct</font> OutputStream *Stream)</a>
<a name="170">{</a>
<a name="171">    PrintInt(Num, -1, FALSE, FALSE, Stream);</a>
<a name="172">}</a>
<a name="173"></a>
<a name="174"><font color="gray">/*<searched> print an integer to a stream without using printf/sprintf */</font></a>
<a name="175"><font color="red">void</font> PrintInt(<font color="red">long</font> Num, <font color="red">int</font> FieldWidth, <font color="red">int</font> ZeroPad, <font color="red">int</font> LeftJustify, <font color="brown">struct</font> OutputStream *Stream)</a>
<a name="176">{</a>
<a name="177">    <font color="green">if</font> (Num &lt 0)</a>
<a name="178">    {</a>
<a name="179">        <a href="stdio_c.html#719">PrintCh</a>('-', Stream);</a>
<a name="180">        Num = -Num;</a>
<a name="181">        <font color="green">if</font> (FieldWidth != 0)</a>
<a name="182">            FieldWidth--;</a>
<a name="183">    }</a>
<a name="184">    </a>
<a name="185">    PrintUnsigned((<font color="red">unsigned</font> <font color="red">long</font>)Num, 10, FieldWidth, ZeroPad, LeftJustify, Stream);</a>
<a name="186">}</a>
<a name="187"></a>
<a name="188">#ifndef NO_FP</a>
<a name="189"><font color="gray">/*<searched> print a double to a stream without using printf/sprintf */</font></a>
<a name="190"><font color="red">void</font> <a href="stdio_c.html#734">PrintFP</a>(<font color="red">double</font> Num, <font color="brown">struct</font> OutputStream *Stream)</a>
<a name="191">{</a>
<a name="192">    <font color="red">int</font> Exponent = 0;</a>
<a name="193">    <font color="red">int</font> MaxDecimal;</a>
<a name="194">    </a>
<a name="195">    <font color="green">if</font> (Num &lt 0)</a>
<a name="196">    {</a>
<a name="197">        <a href="stdio_c.html#719">PrintCh</a>('-', Stream);</a>
<a name="198">        Num = -Num;    </a>
<a name="199">    }</a>
<a name="200">    </a>
<a name="201">    <font color="green">if</font> (Num &gt= 1e7)</a>
<a name="202">        Exponent = log10(Num);</a>
<a name="203">    <font color="green">else</font> <font color="green">if</font> (Num &lt= 1e-7 && Num != 0.0)</a>
<a name="204">        Exponent = log10(Num) - 0.999999999;</a>
<a name="205">    </a>
<a name="206">    Num /= pow(10.0, Exponent);    </a>
<a name="207">    PrintInt((<font color="red">long</font>)Num, 0, FALSE, FALSE, Stream);</a>
<a name="208">    <a href="stdio_c.html#719">PrintCh</a>('.', Stream);</a>
<a name="209">    Num = (Num - (<font color="red">long</font>)Num) * 10;</a>
<a name="210">    <font color="green">if</font> (abs(Num) &gt= 1e-7)</a>
<a name="211">    {</a>
<a name="212">        <font color="green">for</font> (MaxDecimal = 6; MaxDecimal &gt 0 && abs(Num) &gt= 1e-7; Num = (Num - (<font color="red">long</font>)(Num + 1e-7)) * 10, MaxDecimal--)</a>
<a name="213">            <a href="stdio_c.html#719">PrintCh</a>('0' + (<font color="red">long</font>)(Num + 1e-7), Stream);</a>
<a name="214">    }</a>
<a name="215">    <font color="green">else</font></a>
<a name="216">        <a href="stdio_c.html#719">PrintCh</a>('0', Stream);</a>
<a name="217">        </a>
<a name="218">    <font color="green">if</font> (Exponent != 0)</a>
<a name="219">    {</a>
<a name="220">        <a href="stdio_c.html#719">PrintCh</a>('e', Stream);</a>
<a name="221">        PrintInt(Exponent, 0, FALSE, FALSE, Stream);</a>
<a name="222">    }</a>
<a name="223">}</a>
<a name="224">#endif</a>
<a name="225"></a>
<a name="226"><font color="gray">/*<searched> intrinsic functions made available to the language */</font></a>
<a name="227"><font color="red">void</font> GenericPrintf(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs, <font color="brown">struct</font> OutputStream *Stream)</a>
<a name="228">{</a>
<a name="229">    <font color="red">char</font> *FPos;</a>
<a name="230">    <font color="brown">struct</font> Value *NextArg = Param[0];</a>
<a name="231">    <font color="brown">struct</font> ValueType *FormatType;</a>
<a name="232">    <font color="red">int</font> ArgCount = 1;</a>
<a name="233">    <font color="red">int</font> LeftJustify = FALSE;</a>
<a name="234">    <font color="red">int</font> ZeroPad = FALSE;</a>
<a name="235">    <font color="red">int</font> FieldWidth = 0;</a>
<a name="236">    <font color="red">char</font> *Format = Param[0]-&gtVal-&gtPointer;</a>
<a name="237">    </a>
<a name="238">    <font color="green">for</font> (FPos = Format; *FPos != '\0'; FPos++)</a>
<a name="239">    {</a>
<a name="240">        <font color="green">if</font> (*FPos == '%')</a>
<a name="241">        {</a>
<a name="242">            FPos++;</a>
<a name="243">	    FieldWidth = 0;</a>
<a name="244">            <font color="green">if</font> (*FPos == '-')</a>
<a name="245">            {</a>
<a name="246">                <font color="gray">/*<searched> a leading '-' means left justify */</font></a>
<a name="247">                LeftJustify = TRUE;</a>
<a name="248">                FPos++;</a>
<a name="249">            }</a>
<a name="250">            </a>
<a name="251">            <font color="green">if</font> (*FPos == '0')</a>
<a name="252">            {</a>
<a name="253">                <font color="gray">/*<searched> a leading zero means zero pad a decimal number */</font></a>
<a name="254">                ZeroPad = TRUE;</a>
<a name="255">                FPos++;</a>
<a name="256">            }</a>
<a name="257">            </a>
<a name="258">            <font color="gray">/*<searched> get any field width in the format */</font></a>
<a name="259">            <font color="green">while</font> (isdigit((<font color="red">int</font>)*FPos))</a>
<a name="260">                FieldWidth = FieldWidth * 10 + (*FPos++ - '0');</a>
<a name="261">            </a>
<a name="262">            <font color="gray">/*<searched> now check the format type */</font></a>
<a name="263">            <font color="green">switch</font> (*FPos)</a>
<a name="264">            {</a>
<a name="265">                <font color="green">case</font> 's': FormatType = CharPtrType; break;</a>
<a name="266">                <font color="green">case</font> 'd': <font color="green">case</font> 'u': <font color="green">case</font> 'x': <font color="green">case</font> 'b': <font color="green">case</font> 'c': FormatType = &IntType; break;</a>
<a name="267">#ifndef NO_FP</a>
<a name="268">                <font color="green">case</font> 'f': FormatType = &FPType; break;</a>
<a name="269">#endif</a>
<a name="270">                <font color="green">case</font> '%': <a href="stdio_c.html#719">PrintCh</a>('%', Stream); FormatType = NULL; break;</a>
<a name="271">                <font color="green">case</font> '\0': FPos--; FormatType = NULL; break;</a>
<a name="272">                default:  <a href="stdio_c.html#719">PrintCh</a>(*FPos, Stream); FormatType = NULL; break;</a>
<a name="273">            }</a>
<a name="274">            </a>
<a name="275">            <font color="green">if</font> (FormatType != NULL)</a>
<a name="276">            { </a>
<a name="277">                <font color="gray">/*<searched> we have to format something */</font></a>
<a name="278">                <font color="green">if</font> (ArgCount &gt= NumArgs)</a>
<a name="279">                    PrintStr("XXX", Stream);   <font color="gray">/*<searched> not enough parameters for format */</font></a>
<a name="280">                <font color="green">else</font></a>
<a name="281">                {</a>
<a name="282">                    NextArg = (<font color="brown">struct</font> Value *)((<font color="red">char</font> *)NextArg + MEM_ALIGN(sizeof(<font color="brown">struct</font> Value) + <a href="type_c.html#60">TypeStackSizeValue</a>(NextArg)));</a>
<a name="283">                    <font color="green">if</font> (NextArg-&gtTyp != FormatType && </a>
<a name="284">                            !((FormatType == &IntType || *FPos == 'f') && IS_NUMERIC_COERCIBLE(NextArg)) &&</a>
<a name="285">                            !(FormatType == CharPtrType && (NextArg-&gtTyp-&gtBase == TypePointer || </a>
<a name="286">                                                             (NextArg-&gtTyp-&gtBase == TypeArray && NextArg-&gtTyp-&gtFromType-&gtBase == TypeChar) ) ) )</a>
<a name="287">                        PrintStr("XXX", Stream);   <font color="gray">/*<searched> bad type for format */</font></a>
<a name="288">                    <font color="green">else</font></a>
<a name="289">                    {</a>
<a name="290">                        <font color="green">switch</font> (*FPos)</a>
<a name="291">                        {</a>
<a name="292">                            <font color="green">case</font> 's':</a>
<a name="293">                            {</a>
<a name="294">                                <font color="red">char</font> *Str;</a>
<a name="295">                                </a>
<a name="296">                                <font color="green">if</font> (NextArg-&gtTyp-&gtBase == TypePointer)</a>
<a name="297">                                    Str = NextArg-&gtVal-&gtPointer;</a>
<a name="298">                                <font color="green">else</font></a>
<a name="299">                                    Str = &NextArg-&gtVal-&gtArrayMem[0];</a>
<a name="300">                                    </a>
<a name="301">                                <font color="green">if</font> (Str == NULL)</a>
<a name="302">                                    <a href="stdio_c.html#729">PrintStr</a>("NULL", Stream); </a>
<a name="303">                                <font color="green">else</font></a>
<a name="304">                                    <a href="stdio_c.html#729">PrintStr</a>(Str, Stream); </a>
<a name="305">                                break;</a>
<a name="306">                            }</a>
<a name="307">                            <font color="green">case</font> 'd': PrintInt(ExpressionCoerceInteger(NextArg), FieldWidth, ZeroPad, LeftJustify, Stream); break;</a>
<a name="308">                            <font color="green">case</font> 'u': PrintUnsigned(ExpressionCoerceUnsignedInteger(NextArg), 10, FieldWidth, ZeroPad, LeftJustify, Stream); break;</a>
<a name="309">                            <font color="green">case</font> 'x': PrintUnsigned(ExpressionCoerceUnsignedInteger(NextArg), 16, FieldWidth, ZeroPad, LeftJustify, Stream); break;</a>
<a name="310">                            <font color="green">case</font> 'b': PrintUnsigned(ExpressionCoerceUnsignedInteger(NextArg), 2, FieldWidth, ZeroPad, LeftJustify, Stream); break;</a>
<a name="311">                            <font color="green">case</font> 'c': <a href="stdio_c.html#719">PrintCh</a>(ExpressionCoerceUnsignedInteger(NextArg), Stream); break;</a>
<a name="312">#ifndef NO_FP</a>
<a name="313">                            <font color="green">case</font> 'f': <a href="stdio_c.html#734">PrintFP</a>(ExpressionCoerceFP(NextArg), Stream); break;</a>
<a name="314">#endif</a>
<a name="315">                        }</a>
<a name="316">                    }</a>
<a name="317">                }</a>
<a name="318">                </a>
<a name="319">                ArgCount++;</a>
<a name="320">            }</a>
<a name="321">        }</a>
<a name="322">        <font color="green">else</font></a>
<a name="323">            <a href="stdio_c.html#719">PrintCh</a>(*FPos, Stream);</a>
<a name="324">    }</a>
<a name="325">}</a>
<a name="326"></a>
<a name="327"><font color="gray">/*<searched> printf(): print to console output */</font></a>
<a name="328"><font color="red">void</font> LibPrintf(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="329">{</a>
<a name="330">    <font color="brown">struct</font> OutputStream ConsoleStream;</a>
<a name="331">    </a>
<a name="332">    ConsoleStream.Putch = &<a href="platform_unix_c.html#76">PlatformPutc</a>;</a>
<a name="333">    GenericPrintf(Parser, ReturnValue, Param, NumArgs, &ConsoleStream);</a>
<a name="334">}</a>
<a name="335"></a>
<a name="336"><font color="gray">/*<searched> sprintf(): print to a string */</font></a>
<a name="337"><font color="red">void</font> LibSPrintf(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="338">{</a>
<a name="339">    <font color="brown">struct</font> OutputStream StrStream;</a>
<a name="340">    </a>
<a name="341">    StrStream.Putch = &SPutc;</a>
<a name="342">    StrStream.i.Str.Parser = Parser;</a>
<a name="343">    StrStream.i.Str.WritePos = Param[0]-&gtVal-&gtPointer;</a>
<a name="344"></a>
<a name="345">    GenericPrintf(Parser, ReturnValue, Param+1, NumArgs-1, &StrStream);</a>
<a name="346">    <a href="stdio_c.html#719">PrintCh</a>(0, &StrStream);</a>
<a name="347">    ReturnValue-&gtVal-&gtPointer = *Param;</a>
<a name="348">}</a>
<a name="349"></a>
<a name="350"><font color="gray">/*<searched> get a line of input. protected from buffer overrun */</font></a>
<a name="351"><font color="red">void</font> LibGets(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="352">{</a>
<a name="353">    ReturnValue-&gtVal-&gtPointer = <a href="platform_unix_c.html#39">PlatformGetLine</a>(Param[0]-&gtVal-&gtPointer, GETS_BUF_MAX, NULL);</a>
<a name="354">    <font color="green">if</font> (ReturnValue-&gtVal-&gtPointer != NULL)</a>
<a name="355">    {</a>
<a name="356">        <font color="red">char</font> *EOLPos = strchr(Param[0]-&gtVal-&gtPointer, '\n');</a>
<a name="357">        <font color="green">if</font> (EOLPos != NULL)</a>
<a name="358">            *EOLPos = '\0';</a>
<a name="359">    }</a>
<a name="360">}</a>
<a name="361"></a>
<a name="362"><font color="red">void</font> LibGetc(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="363">{</a>
<a name="364">    ReturnValue-&gtVal-&gtInteger = <a href="platform_unix_c.html#69">PlatformGetCharacter</a>();</a>
<a name="365">}</a>
<a name="366"></a>
<a name="367"><font color="red">void</font> LibExit(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="368">{</a>
<a name="369">    <a href="platform_unix_c.html#135">PlatformExit</a>(Param[0]-&gtVal-&gtInteger);</a>
<a name="370">}</a>
<a name="371"></a>
<a name="372">#ifdef PICOC_LIBRARY</a>
<a name="373"><font color="red">void</font> LibSin(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="374">{</a>
<a name="375">    ReturnValue-&gtVal-&gtFP = sin(Param[0]-&gtVal-&gtFP);</a>
<a name="376">}</a>
<a name="377"></a>
<a name="378"><font color="red">void</font> LibCos(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="379">{</a>
<a name="380">    ReturnValue-&gtVal-&gtFP = cos(Param[0]-&gtVal-&gtFP);</a>
<a name="381">}</a>
<a name="382"></a>
<a name="383"><font color="red">void</font> LibTan(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="384">{</a>
<a name="385">    ReturnValue-&gtVal-&gtFP = tan(Param[0]-&gtVal-&gtFP);</a>
<a name="386">}</a>
<a name="387"></a>
<a name="388"><font color="red">void</font> LibAsin(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="389">{</a>
<a name="390">    ReturnValue-&gtVal-&gtFP = asin(Param[0]-&gtVal-&gtFP);</a>
<a name="391">}</a>
<a name="392"></a>
<a name="393"><font color="red">void</font> LibAcos(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="394">{</a>
<a name="395">    ReturnValue-&gtVal-&gtFP = acos(Param[0]-&gtVal-&gtFP);</a>
<a name="396">}</a>
<a name="397"></a>
<a name="398"><font color="red">void</font> LibAtan(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="399">{</a>
<a name="400">    ReturnValue-&gtVal-&gtFP = atan(Param[0]-&gtVal-&gtFP);</a>
<a name="401">}</a>
<a name="402"></a>
<a name="403"><font color="red">void</font> LibSinh(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="404">{</a>
<a name="405">    ReturnValue-&gtVal-&gtFP = sinh(Param[0]-&gtVal-&gtFP);</a>
<a name="406">}</a>
<a name="407"></a>
<a name="408"><font color="red">void</font> LibCosh(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="409">{</a>
<a name="410">    ReturnValue-&gtVal-&gtFP = cosh(Param[0]-&gtVal-&gtFP);</a>
<a name="411">}</a>
<a name="412"></a>
<a name="413"><font color="red">void</font> LibTanh(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="414">{</a>
<a name="415">    ReturnValue-&gtVal-&gtFP = tanh(Param[0]-&gtVal-&gtFP);</a>
<a name="416">}</a>
<a name="417"></a>
<a name="418"><font color="red">void</font> LibExp(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="419">{</a>
<a name="420">    ReturnValue-&gtVal-&gtFP = exp(Param[0]-&gtVal-&gtFP);</a>
<a name="421">}</a>
<a name="422"></a>
<a name="423"><font color="red">void</font> LibFabs(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="424">{</a>
<a name="425">    ReturnValue-&gtVal-&gtFP = fabs(Param[0]-&gtVal-&gtFP);</a>
<a name="426">}</a>
<a name="427"></a>
<a name="428"><font color="red">void</font> LibLog(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="429">{</a>
<a name="430">    ReturnValue-&gtVal-&gtFP = log(Param[0]-&gtVal-&gtFP);</a>
<a name="431">}</a>
<a name="432"></a>
<a name="433"><font color="red">void</font> LibLog10(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="434">{</a>
<a name="435">    ReturnValue-&gtVal-&gtFP = log10(Param[0]-&gtVal-&gtFP);</a>
<a name="436">}</a>
<a name="437"></a>
<a name="438"><font color="red">void</font> LibPow(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="439">{</a>
<a name="440">    ReturnValue-&gtVal-&gtFP = pow(Param[0]-&gtVal-&gtFP, Param[1]-&gtVal-&gtFP);</a>
<a name="441">}</a>
<a name="442"></a>
<a name="443"><font color="red">void</font> LibSqrt(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="444">{</a>
<a name="445">    ReturnValue-&gtVal-&gtFP = sqrt(Param[0]-&gtVal-&gtFP);</a>
<a name="446">}</a>
<a name="447"></a>
<a name="448"><font color="red">void</font> LibRound(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="449">{</a>
<a name="450">    ReturnValue-&gtVal-&gtFP = floor(Param[0]-&gtVal-&gtFP + 0.5);   <font color="gray">/*<searched> XXX - fix for soft float */</font></a>
<a name="451">}</a>
<a name="452"></a>
<a name="453"><font color="red">void</font> LibCeil(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="454">{</a>
<a name="455">    ReturnValue-&gtVal-&gtFP = ceil(Param[0]-&gtVal-&gtFP);</a>
<a name="456">}</a>
<a name="457"></a>
<a name="458"><font color="red">void</font> LibFloor(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="459">{</a>
<a name="460">    ReturnValue-&gtVal-&gtFP = floor(Param[0]-&gtVal-&gtFP);</a>
<a name="461">}</a>
<a name="462">#endif</a>
<a name="463"></a>
<a name="464">#ifndef NO_STRING_FUNCTIONS</a>
<a name="465"><font color="red">void</font> LibMalloc(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="466">{</a>
<a name="467">    ReturnValue-&gtVal-&gtPointer = malloc(Param[0]-&gtVal-&gtInteger);</a>
<a name="468">}</a>
<a name="469"></a>
<a name="470">#ifndef NO_CALLOC</a>
<a name="471"><font color="red">void</font> LibCalloc(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="472">{</a>
<a name="473">    ReturnValue-&gtVal-&gtPointer = calloc(Param[0]-&gtVal-&gtInteger, Param[1]-&gtVal-&gtInteger);</a>
<a name="474">}</a>
<a name="475">#endif</a>
<a name="476"></a>
<a name="477">#ifndef NO_REALLOC</a>
<a name="478"><font color="red">void</font> LibRealloc(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="479">{</a>
<a name="480">    ReturnValue-&gtVal-&gtPointer = realloc(Param[0]-&gtVal-&gtPointer, Param[1]-&gtVal-&gtInteger);</a>
<a name="481">}</a>
<a name="482">#endif</a>
<a name="483"></a>
<a name="484"><font color="red">void</font> LibFree(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="485">{</a>
<a name="486">    free(Param[0]-&gtVal-&gtPointer);</a>
<a name="487">}</a>
<a name="488"></a>
<a name="489"><font color="red">void</font> LibStrcpy(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="490">{</a>
<a name="491">    <font color="red">char</font> *To = (<font color="red">char</font> *)Param[0]-&gtVal-&gtPointer;</a>
<a name="492">    <font color="red">char</font> *From = (<font color="red">char</font> *)Param[1]-&gtVal-&gtPointer;</a>
<a name="493">    </a>
<a name="494">    <font color="green">while</font> (*From != '\0')</a>
<a name="495">        *To++ = *From++;</a>
<a name="496">    </a>
<a name="497">    *To = '\0';</a>
<a name="498">}</a>
<a name="499"></a>
<a name="500"><font color="red">void</font> LibStrncpy(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="501">{</a>
<a name="502">    <font color="red">char</font> *To = (<font color="red">char</font> *)Param[0]-&gtVal-&gtPointer;</a>
<a name="503">    <font color="red">char</font> *From = (<font color="red">char</font> *)Param[1]-&gtVal-&gtPointer;</a>
<a name="504">    <font color="red">int</font> Len = Param[2]-&gtVal-&gtInteger;</a>
<a name="505">    </a>
<a name="506">    <font color="green">for</font> (; *From != '\0' && Len &gt 0; Len--)</a>
<a name="507">        *To++ = *From++;</a>
<a name="508">    </a>
<a name="509">    <font color="green">if</font> (Len &gt 0)</a>
<a name="510">        *To = '\0';</a>
<a name="511">}</a>
<a name="512"></a>
<a name="513"><font color="red">void</font> LibStrcmp(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="514">{</a>
<a name="515">    <font color="red">char</font> *Str1 = (<font color="red">char</font> *)Param[0]-&gtVal-&gtPointer;</a>
<a name="516">    <font color="red">char</font> *Str2 = (<font color="red">char</font> *)Param[1]-&gtVal-&gtPointer;</a>
<a name="517">    <font color="red">int</font> StrEnded;</a>
<a name="518">    </a>
<a name="519">    <font color="green">for</font> (StrEnded = FALSE; !StrEnded; StrEnded = (*Str1 == '\0' || *Str2 == '\0'), Str1++, Str2++)</a>
<a name="520">    {</a>
<a name="521">         <font color="green">if</font> (*Str1 &lt *Str2) { ReturnValue-&gtVal-&gtInteger = -1; <font color="green">return</font>; } </a>
<a name="522">         <font color="green">else</font> <font color="green">if</font> (*Str1 &gt *Str2) { ReturnValue-&gtVal-&gtInteger = 1; <font color="green">return</font>; }</a>
<a name="523">    }</a>
<a name="524">    </a>
<a name="525">    ReturnValue-&gtVal-&gtInteger = 0;</a>
<a name="526">}</a>
<a name="527"></a>
<a name="528"><font color="red">void</font> LibStrncmp(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="529">{</a>
<a name="530">    <font color="red">char</font> *Str1 = (<font color="red">char</font> *)Param[0]-&gtVal-&gtPointer;</a>
<a name="531">    <font color="red">char</font> *Str2 = (<font color="red">char</font> *)Param[1]-&gtVal-&gtPointer;</a>
<a name="532">    <font color="red">int</font> Len = Param[2]-&gtVal-&gtInteger;</a>
<a name="533">    <font color="red">int</font> StrEnded;</a>
<a name="534">    </a>
<a name="535">    <font color="green">for</font> (StrEnded = FALSE; !StrEnded && Len &gt 0; StrEnded = (*Str1 == '\0' || *Str2 == '\0'), Str1++, Str2++, Len--)</a>
<a name="536">    {</a>
<a name="537">         <font color="green">if</font> (*Str1 &lt *Str2) { ReturnValue-&gtVal-&gtInteger = -1; <font color="green">return</font>; } </a>
<a name="538">         <font color="green">else</font> <font color="green">if</font> (*Str1 &gt *Str2) { ReturnValue-&gtVal-&gtInteger = 1; <font color="green">return</font>; }</a>
<a name="539">    }</a>
<a name="540">    </a>
<a name="541">    ReturnValue-&gtVal-&gtInteger = 0;</a>
<a name="542">}</a>
<a name="543"></a>
<a name="544"><font color="red">void</font> LibStrcat(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="545">{</a>
<a name="546">    <font color="red">char</font> *To = (<font color="red">char</font> *)Param[0]-&gtVal-&gtPointer;</a>
<a name="547">    <font color="red">char</font> *From = (<font color="red">char</font> *)Param[1]-&gtVal-&gtPointer;</a>
<a name="548">    </a>
<a name="549">    <font color="green">while</font> (*To != '\0')</a>
<a name="550">        To++;</a>
<a name="551">    </a>
<a name="552">    <font color="green">while</font> (*From != '\0')</a>
<a name="553">        *To++ = *From++;</a>
<a name="554">    </a>
<a name="555">    *To = '\0';</a>
<a name="556">}</a>
<a name="557"></a>
<a name="558"><font color="red">void</font> LibIndex(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="559">{</a>
<a name="560">    <font color="red">char</font> *Pos = (<font color="red">char</font> *)Param[0]-&gtVal-&gtPointer;</a>
<a name="561">    <font color="red">int</font> SearchChar = Param[1]-&gtVal-&gtInteger;</a>
<a name="562"></a>
<a name="563">    <font color="green">while</font> (*Pos != '\0' && *Pos != SearchChar)</a>
<a name="564">        Pos++;</a>
<a name="565">    </a>
<a name="566">    <font color="green">if</font> (*Pos != SearchChar)</a>
<a name="567">        ReturnValue-&gtVal-&gtPointer = NULL;</a>
<a name="568">    <font color="green">else</font></a>
<a name="569">        ReturnValue-&gtVal-&gtPointer = Pos;</a>
<a name="570">}</a>
<a name="571"></a>
<a name="572"><font color="red">void</font> LibRindex(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="573">{</a>
<a name="574">    <font color="red">char</font> *Pos = (<font color="red">char</font> *)Param[0]-&gtVal-&gtPointer;</a>
<a name="575">    <font color="red">int</font> SearchChar = Param[1]-&gtVal-&gtInteger;</a>
<a name="576"></a>
<a name="577">    ReturnValue-&gtVal-&gtPointer = NULL;</a>
<a name="578">    <font color="green">for</font> (; *Pos != '\0'; Pos++)</a>
<a name="579">    {</a>
<a name="580">        <font color="green">if</font> (*Pos == SearchChar)</a>
<a name="581">            ReturnValue-&gtVal-&gtPointer = Pos;</a>
<a name="582">    }</a>
<a name="583">}</a>
<a name="584"></a>
<a name="585"><font color="red">void</font> LibStrlen(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="586">{</a>
<a name="587">    <font color="red">char</font> *Pos = (<font color="red">char</font> *)Param[0]-&gtVal-&gtPointer;</a>
<a name="588">    <font color="red">int</font> Len;</a>
<a name="589">    </a>
<a name="590">    <font color="green">for</font> (Len = 0; *Pos != '\0'; Pos++)</a>
<a name="591">        Len++;</a>
<a name="592">    </a>
<a name="593">    ReturnValue-&gtVal-&gtInteger = Len;</a>
<a name="594">}</a>
<a name="595"></a>
<a name="596"><font color="red">void</font> LibMemset(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="597">{</a>
<a name="598">    <font color="gray">/*<searched> we can use the system memset() */</font></a>
<a name="599">    memset(Param[0]-&gtVal-&gtPointer, Param[1]-&gtVal-&gtInteger, Param[2]-&gtVal-&gtInteger);</a>
<a name="600">}</a>
<a name="601"></a>
<a name="602"><font color="red">void</font> LibMemcpy(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="603">{</a>
<a name="604">    <font color="gray">/*<searched> we can use the system memcpy() */</font></a>
<a name="605">    memcpy(Param[0]-&gtVal-&gtPointer, Param[1]-&gtVal-&gtPointer, Param[2]-&gtVal-&gtInteger);</a>
<a name="606">}</a>
<a name="607"></a>
<a name="608"><font color="red">void</font> LibMemcmp(<font color="brown">struct</font> ParseState *Parser, <font color="brown">struct</font> Value *ReturnValue, <font color="brown">struct</font> Value **Param, <font color="red">int</font> NumArgs)</a>
<a name="609">{</a>
<a name="610">    <font color="red">unsigned</font> <font color="red">char</font> *Mem1 = (<font color="red">unsigned</font> <font color="red">char</font> *)Param[0]-&gtVal-&gtPointer;</a>
<a name="611">    <font color="red">unsigned</font> <font color="red">char</font> *Mem2 = (<font color="red">unsigned</font> <font color="red">char</font> *)Param[1]-&gtVal-&gtPointer;</a>
<a name="612">    <font color="red">int</font> Len = Param[2]-&gtVal-&gtInteger;</a>
<a name="613">    </a>
<a name="614">    <font color="green">for</font> (; Len &gt 0; Mem1++, Mem2++, Len--)</a>
<a name="615">    {</a>
<a name="616">         <font color="green">if</font> (*Mem1 &lt *Mem2) { ReturnValue-&gtVal-&gtInteger = -1; <font color="green">return</font>; } </a>
<a name="617">         <font color="green">else</font> <font color="green">if</font> (*Mem1 &gt *Mem2) { ReturnValue-&gtVal-&gtInteger = 1; <font color="green">return</font>; }</a>
<a name="618">    }</a>
<a name="619">    </a>
<a name="620">    ReturnValue-&gtVal-&gtInteger = 0;</a>
<a name="621">}</a>
<a name="622">#endif</a>
<a name="623"></a>
<a name="624"><font color="gray">/*<searched> list of all library functions and their prototypes */</font></a>
<a name="625"><font color="brown">struct</font> LibraryFunction CLibrary[] =</a>
<a name="626">{</a>
<a name="627">    { LibPrintf,        "<font color="red">void</font> printf(<font color="red">char</font> *, ...);" },</a>
<a name="628">    { LibSPrintf,       "<font color="red">char</font> *sprintf(<font color="red">char</font> *, <font color="red">char</font> *, ...);" },</a>
<a name="629">    { LibGets,          "<font color="red">char</font> *gets(<font color="red">char</font> *);" },</a>
<a name="630">    { LibGetc,          "<font color="red">int</font> getchar();" },</a>
<a name="631">    { LibExit,          "<font color="red">void</font> exit(<font color="red">int</font>);" },</a>
<a name="632">#ifdef PICOC_LIBRARY</a>
<a name="633">    { LibSin,           "<font color="red">float</font> sin(<font color="red">float</font>);" },</a>
<a name="634">    { LibCos,           "<font color="red">float</font> cos(<font color="red">float</font>);" },</a>
<a name="635">    { LibTan,           "<font color="red">float</font> tan(<font color="red">float</font>);" },</a>
<a name="636">    { LibAsin,          "<font color="red">float</font> asin(<font color="red">float</font>);" },</a>
<a name="637">    { LibAcos,          "<font color="red">float</font> acos(<font color="red">float</font>);" },</a>
<a name="638">    { LibAtan,          "<font color="red">float</font> atan(<font color="red">float</font>);" },</a>
<a name="639">    { LibSinh,          "<font color="red">float</font> sinh(<font color="red">float</font>);" },</a>
<a name="640">    { LibCosh,          "<font color="red">float</font> cosh(<font color="red">float</font>);" },</a>
<a name="641">    { LibTanh,          "<font color="red">float</font> tanh(<font color="red">float</font>);" },</a>
<a name="642">    { LibExp,           "<font color="red">float</font> exp(<font color="red">float</font>);" },</a>
<a name="643">    { LibFabs,          "<font color="red">float</font> fabs(<font color="red">float</font>);" },</a>
<a name="644">    { LibLog,           "<font color="red">float</font> log(<font color="red">float</font>);" },</a>
<a name="645">    { LibLog10,         "<font color="red">float</font> log10(<font color="red">float</font>);" },</a>
<a name="646">    { LibPow,           "<font color="red">float</font> pow(<font color="red">float</font>,<font color="red">float</font>);" },</a>
<a name="647">    { LibSqrt,          "<font color="red">float</font> sqrt(<font color="red">float</font>);" },</a>
<a name="648">    { LibRound,         "<font color="red">float</font> round(<font color="red">float</font>);" },</a>
<a name="649">    { LibCeil,          "<font color="red">float</font> ceil(<font color="red">float</font>);" },</a>
<a name="650">    { LibFloor,         "<font color="red">float</font> floor(<font color="red">float</font>);" },</a>
<a name="651">#endif</a>
<a name="652">    { LibMalloc,        "<font color="red">void</font> *malloc(<font color="red">int</font>);" },</a>
<a name="653">#ifndef NO_CALLOC</a>
<a name="654">    { LibCalloc,        "<font color="red">void</font> *calloc(<font color="red">int</font>,<font color="red">int</font>);" },</a>
<a name="655">#endif</a>
<a name="656">#ifndef NO_REALLOC</a>
<a name="657">    { LibRealloc,       "<font color="red">void</font> *realloc(<font color="red">void</font> *,<font color="red">int</font>);" },</a>
<a name="658">#endif</a>
<a name="659">    { LibFree,          "<font color="red">void</font> free(<font color="red">void</font> *);" },</a>
<a name="660">#ifndef NO_STRING_FUNCTIONS</a>
<a name="661">    { LibStrcpy,        "<font color="red">void</font> strcpy(<font color="red">char</font> *,<font color="red">char</font> *);" },</a>
<a name="662">    { LibStrncpy,       "<font color="red">void</font> strncpy(<font color="red">char</font> *,<font color="red">char</font> *,<font color="red">int</font>);" },</a>
<a name="663">    { LibStrcmp,        "<font color="red">int</font> strcmp(<font color="red">char</font> *,<font color="red">char</font> *);" },</a>
<a name="664">    { LibStrncmp,       "<font color="red">int</font> strncmp(<font color="red">char</font> *,<font color="red">char</font> *,<font color="red">int</font>);" },</a>
<a name="665">    { LibStrcat,        "<font color="red">void</font> strcat(<font color="red">char</font> *,<font color="red">char</font> *);" },</a>
<a name="666">    { LibIndex,         "<font color="red">char</font> *index(<font color="red">char</font> *,<font color="red">int</font>);" },</a>
<a name="667">    { LibRindex,        "<font color="red">char</font> *rindex(<font color="red">char</font> *,<font color="red">int</font>);" },</a>
<a name="668">    { LibStrlen,        "<font color="red">int</font> strlen(<font color="red">char</font> *);" },</a>
<a name="669">    { LibMemset,        "<font color="red">void</font> memset(<font color="red">void</font> *,<font color="red">int</font>,<font color="red">int</font>);" },</a>
<a name="670">    { LibMemcpy,        "<font color="red">void</font> memcpy(<font color="red">void</font> *,<font color="red">void</font> *,<font color="red">int</font>);" },</a>
<a name="671">    { LibMemcmp,        "<font color="red">int</font> memcmp(<font color="red">void</font> *,<font color="red">void</font> *,<font color="red">int</font>);" },</a>
<a name="672">#endif</a>
<a name="673">    { NULL,             NULL }</a>
<a name="674">};</a>
<a name="675"></a>
<a name="676">#endif <font color="gray">/*<searched> BUILTIN_MINI_STDLIB */</font></a>
</pre></body></html>