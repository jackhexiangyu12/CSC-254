<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head>
<body><pre><a name="1">/* string.h library for large systems - small embedded systems use clibrary.c instead */</a>
<a name="2">#include &lttime.h&gt</a>
<a name="3">#include "../interpreter.h"</a>
<a name="4"></a>
<a name="5">#ifndef BUILTIN_MINI_STDLIB</a>
<a name="6"></a>
<a name="7">static int <a href="time_c.html#7">CLOCKS_PER_SECValue</a> = CLOCKS_PER_SEC;</a>
<a name="8"></a>
<a name="9">#ifdef CLK_PER_SEC</a>
<a name="10">static int CLK_PER_SECValue = CLK_PER_SEC;</a>
<a name="11">#endif</a>
<a name="12"></a>
<a name="13">#ifdef CLK_TCK</a>
<a name="14">static int CLK_TCKValue = CLK_TCK;</a>
<a name="15">#endif</a>
<a name="16"></a>
<a name="17">void <a href="time_c.html#17">StdAsctime</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="18">{</a>
<a name="19">    <a href="time_c.html#17">ReturnValue</a>-&gtVal-&gtPointer = asctime(<a href="time_c.html#17">Param</a>[0]-&gtVal-&gtPointer);</a>
<a name="20">}</a>
<a name="21"></a>
<a name="22">void <a href="time_c.html#22">StdClock</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="23">{</a>
<a name="24">    <a href="time_c.html#22">ReturnValue</a>-&gtVal-&gtInteger = clock();</a>
<a name="25">}</a>
<a name="26"></a>
<a name="27">void <a href="time_c.html#27">StdCtime</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="28">{</a>
<a name="29">    <a href="time_c.html#27">ReturnValue</a>-&gtVal-&gtPointer = ctime(<a href="time_c.html#27">Param</a>[0]-&gtVal-&gtPointer);</a>
<a name="30">}</a>
<a name="31"></a>
<a name="32">#ifndef NO_FP</a>
<a name="33">void <a href="time_c.html#33">StdDifftime</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="34">{</a>
<a name="35">    <a href="time_c.html#33">ReturnValue</a>-&gtVal-&gtFP = difftime((time_t)<a href="time_c.html#33">Param</a>[0]-&gtVal-&gtInteger, <a href="time_c.html#33">Param</a>[1]-&gtVal-&gtInteger);</a>
<a name="36">}</a>
<a name="37">#endif</a>
<a name="38"></a>
<a name="39">void <a href="time_c.html#39">StdGmtime</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="40">{</a>
<a name="41">    <a href="time_c.html#39">ReturnValue</a>-&gtVal-&gtPointer = gmtime(<a href="time_c.html#39">Param</a>[0]-&gtVal-&gtPointer);</a>
<a name="42">}</a>
<a name="43"></a>
<a name="44">void <a href="time_c.html#44">StdLocaltime</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="45">{</a>
<a name="46">    <a href="time_c.html#44">ReturnValue</a>-&gtVal-&gtPointer = localtime(<a href="time_c.html#44">Param</a>[0]-&gtVal-&gtPointer);</a>
<a name="47">}</a>
<a name="48"></a>
<a name="49">void <a href="time_c.html#49">StdMktime</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="50">{</a>
<a name="51">    <a href="time_c.html#49">ReturnValue</a>-&gtVal-&gtInteger = (int)mktime(<a href="time_c.html#49">Param</a>[0]-&gtVal-&gtPointer);</a>
<a name="52">}</a>
<a name="53"></a>
<a name="54">void <a href="time_c.html#54">StdTime</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="55">{</a>
<a name="56">    <a href="time_c.html#54">ReturnValue</a>-&gtVal-&gtInteger = (int)time(<a href="time_c.html#54">Param</a>[0]-&gtVal-&gtPointer);</a>
<a name="57">}</a>
<a name="58"></a>
<a name="59">void <a href="time_c.html#59">StdStrftime</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="60">{</a>
<a name="61">    <a href="time_c.html#59">ReturnValue</a>-&gtVal-&gtInteger = strftime(<a href="time_c.html#59">Param</a>[0]-&gtVal-&gtPointer, <a href="time_c.html#59">Param</a>[1]-&gtVal-&gtInteger, <a href="time_c.html#59">Param</a>[2]-&gtVal-&gtPointer, <a href="time_c.html#59">Param</a>[3]-&gtVal-&gtPointer);</a>
<a name="62">}</a>
<a name="63"></a>
<a name="64">#ifndef WIN32</a>
<a name="65">void <a href="time_c.html#65">StdStrptime</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="66">{</a>
<a name="67">	  extern char *<a name="searched">strptime</a>(const char *s, const char *format, struct tm *tm);</a>
<a name="68">	  </a>
<a name="69">    <a href="time_c.html#65">ReturnValue</a>-&gtVal-&gtPointer = <a href="time_c.html#67">strptime</a>(<a href="time_c.html#65">Param</a>[0]-&gtVal-&gtPointer, <a href="time_c.html#65">Param</a>[1]-&gtVal-&gtPointer, <a href="time_c.html#65">Param</a>[2]-&gtVal-&gtPointer);</a>
<a name="70">}</a>
<a name="71"></a>
<a name="72">void <a href="time_c.html#72">StdGmtime_r</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="73">{</a>
<a name="74">    <a href="time_c.html#72">ReturnValue</a>-&gtVal-&gtPointer = gmtime_r(<a href="time_c.html#72">Param</a>[0]-&gtVal-&gtPointer, <a href="time_c.html#72">Param</a>[1]-&gtVal-&gtPointer);</a>
<a name="75">}</a>
<a name="76"></a>
<a name="77">void <a href="time_c.html#77">StdTimegm</a>(struct ParseState *<a name="searched">Parser</a>, struct Value *<a name="searched">ReturnValue</a>, struct Value **<a name="searched">Param</a>, int <a name="searched">NumArgs</a>)</a>
<a name="78">{</a>
<a name="79">    <a href="time_c.html#77">ReturnValue</a>-&gtVal-&gtInteger = timegm(<a href="time_c.html#77">Param</a>[0]-&gtVal-&gtPointer);</a>
<a name="80">}</a>
<a name="81">#endif</a>
<a name="82"></a>
<a name="83">/* handy structure definitions */</a>
<a name="84">const char <a href="interpreter_h.html#636">StdTimeDefs</a>[] = "\</a>
<a name="85">typedef int time_t; \</a>
<a name="86">typedef int clock_t;\</a>
<a name="87">";</a>
<a name="88"></a>
<a name="89">/* all string.h functions */</a>
<a name="90">struct LibraryFunction <a href="interpreter_h.html#637">StdTimeFunctions</a>[] =</a>
<a name="91">{</a>
<a name="92">    { <a href="time_c.html#17">StdAsctime</a>,       "char *asctime(struct tm *);" },</a>
<a name="93">    { <a href="time_c.html#22">StdClock</a>,         "time_t clock();" },</a>
<a name="94">    { <a href="time_c.html#27">StdCtime</a>,         "char *ctime(int *);" },</a>
<a name="95">#ifndef NO_FP</a>
<a name="96">    { <a href="time_c.html#33">StdDifftime</a>,      "double difftime(int, int);" },</a>
<a name="97">#endif</a>
<a name="98">    { <a href="time_c.html#39">StdGmtime</a>,        "struct tm *gmtime(int *);" },</a>
<a name="99">    { <a href="time_c.html#44">StdLocaltime</a>,     "struct tm *localtime(int *);" },</a>
<a name="100">    { <a href="time_c.html#49">StdMktime</a>,        "int mktime(struct tm *ptm);" },</a>
<a name="101">    { <a href="time_c.html#54">StdTime</a>,          "int time(int *);" },</a>
<a name="102">    { <a href="time_c.html#59">StdStrftime</a>,      "int strftime(char *, int, char *, struct tm *);" },</a>
<a name="103">#ifndef WIN32</a>
<a name="104">    { <a href="time_c.html#65">StdStrptime</a>,      "char *strptime(char *, char *, struct tm *);" },</a>
<a name="105">	{ <a href="time_c.html#72">StdGmtime_r</a>,      "struct tm *gmtime_r(int *, struct tm *);" },</a>
<a name="106">    { <a href="time_c.html#77">StdTimegm</a>,        "int timegm(struct tm *);" },</a>
<a name="107">#endif</a>
<a name="108">    { NULL,             NULL }</a>
<a name="109">};</a>
<a name="110"></a>
<a name="111"></a>
<a name="112">/* creates various system-dependent definitions */</a>
<a name="113">void <a href="time_c.html#113">StdTimeSetupFunc</a>(Picoc *<a name="searched">pc</a>)</a>
<a name="114">{</a>
<a name="115">    /* make a "struct tm" which is the same size as a native tm structure */</a>
<a name="116">    <a href="type_c.html#272">TypeCreateOpaqueStruct</a>(<a href="time_c.html#113">pc</a>, NULL, <a href="table_c.html#166">TableStrRegister</a>(<a href="time_c.html#113">pc</a>, "tm"), sizeof(struct tm));</a>
<a name="117">    </a>
<a name="118">    /* define CLK_PER_SEC etc. */</a>
<a name="119">    <a href="variable_c.html#375">VariableDefinePlatformVar</a>(<a href="time_c.html#113">pc</a>, NULL, "CLOCKS_PER_SEC", &<a href="time_c.html#113">pc</a>-&gtIntType, (union AnyValue *)&<a href="time_c.html#7">CLOCKS_PER_SECValue</a>, FALSE);</a>
<a name="120">#ifdef CLK_PER_SEC</a>
<a name="121">    <a href="variable_c.html#375">VariableDefinePlatformVar</a>(<a href="time_c.html#113">pc</a>, NULL, "CLK_PER_SEC", &<a href="time_c.html#113">pc</a>-&gtIntType, (union AnyValue *)&CLK_PER_SECValue, FALSE);</a>
<a name="122">#endif</a>
<a name="123">#ifdef CLK_TCK</a>
<a name="124">    <a href="variable_c.html#375">VariableDefinePlatformVar</a>(<a href="time_c.html#113">pc</a>, NULL, "CLK_TCK", &<a href="time_c.html#113">pc</a>-&gtIntType, (union AnyValue *)&CLK_TCKValue, FALSE);</a>
<a name="125">#endif</a>
<a name="126">}</a>
<a name="127"></a>
<a name="128">#endif /* !BUILTIN_MINI_STDLIB */</a>
</pre></body></html>